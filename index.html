<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Buen Sazón - Premium Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --gold: #c5a059;
            --fire: #ff4500;
            --lava: linear-gradient(135deg, #e67e22, #c0392b);
            --cold: #1a1a1a;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #000; color: #fff; 
            width: 100vw; overflow-x: hidden;
            display: flex; flex-direction: column; align-items: center;
            position: relative;
        }

        /* --- FONDO DINÁMICO --- */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 80%, rgba(230, 126, 34, 0.15), transparent 70%);
            animation: fireGlow 4s infinite alternate; z-index: -1;
        }
        @keyframes fireGlow { from { opacity: 0.4; } to { opacity: 0.8; } }

        #embers-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }

        /* --- CABECERA --- */
        .header-visual { text-align: center; margin: 40px 0; width: 100%; z-index: 10; }
        .header-large { font-size: clamp(2.2rem, 10vw, 3.8rem); color: var(--gold); font-family: 'Playfair Display', serif; cursor: pointer; letter-spacing: 2px; }
        
        .day-label { font-size: 1.1rem; color: #888; margin-top: 10px; text-transform: uppercase; letter-spacing: 2px; }
        .day-main { font-size: 2.5rem; color: var(--gold); font-family: 'Playfair Display', serif; margin-top: -5px; text-shadow: 0 0 15px rgba(197, 160, 89, 0.4); }

        /* --- TARJETAS CON EFECTO ENFRIAMIENTO --- */
        .cards-container { 
            display: flex; flex-direction: column; align-items: center; gap: 30px; 
            width: 100%; max-width: 1100px; padding: 0 20px 100px 20px; z-index: 10;
        }
        @media (min-width: 768px) { .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); } }
        
        .card { 
            background: var(--lava); border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; 
            padding: 35px; width: 100%; position: relative; overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            animation: entryBounce 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards,
                       coolDown 20s ease-in-out forwards; 
            opacity: 0; transform: translateY(50px);
        }

        @keyframes entryBounce { to { opacity: 1; transform: translateY(0); } }
        @keyframes coolDown { 
            0% { background: var(--lava); box-shadow: 0 0 30px rgba(230, 126, 34, 0.5); }
            100% { background: var(--cold); box-shadow: 0 10px 30px rgba(0,0,0,0.8); border-color: #333; }
        }

        /* Humo realista */
        .smoke { position: absolute; bottom: -20px; width: 40px; height: 40px; background: rgba(255,255,255,0.2); filter: blur(20px); border-radius: 50%; animation: smokeRise 4s infinite linear; opacity: 0; }
        .card:hover .smoke { opacity: 0.6; }
        @keyframes smokeRise { 0% { transform: translateY(0) scale(1); opacity: 0; } 50% { opacity: 0.3; } 100% { transform: translateY(-200px) scale(4); opacity: 0; } }

        .card-title { color: #fff; font-size: 1.8rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px; margin-bottom: 15px; font-family: 'Playfair Display', serif; }
        .item-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* --- GALERÍA TRASLÚCIDA --- */
        #gallery-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); backdrop-filter: blur(15px);
            display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; 
        }
        .slider-box { width: 85%; max-width: 450px; text-align: center; position: relative; overflow: hidden; height: 500px; }
        
        .slide-container { position: relative; width: 100%; height: 400px; display: flex; align-items: center; justify-content: center; }
        .slide-img { 
            position: absolute; width: 100%; aspect-ratio: 1/1; object-fit: cover; 
            border-radius: 20px; border: 2px solid var(--gold);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Clases para animación lateral */
        .slide-in-right { transform: translateX(100%); opacity: 0; }
        .slide-active { transform: translateX(0); opacity: 1; }
        .slide-out-left { transform: translateX(-100%); opacity: 0; }

        .close-btn { 
            position: fixed; bottom: 40px; width: 60px; height: 60px; 
            background: #000; border: 2px solid var(--gold); border-radius: 50%; 
            color: var(--gold); display: flex; align-items: center; justify-content: center; 
            font-size: 24px; cursor: pointer; z-index: 10001; 
        }

        /* --- EDITOR --- */
        #edition-view { display: none; flex-direction: column; align-items: center; padding: 20px; background: #000; min-height: 100vh; width: 100%; z-index: 10002; }
        .edit-panel { width: 100%; max-width: 600px; background: #111; border: 1px solid var(--gold); border-radius: 15px; padding: 20px; }
        input, select { width: 100%; padding: 12px; background: #222; color: #fff; border: 1px solid #444; border-radius: 8px; margin: 5px 0 15px 0; }
        .btn-save-cloud { background: var(--gold); color: #000; font-weight: bold; padding: 20px; width: 100%; max-width: 400px; border-radius: 50px; border: none; cursor: pointer; margin-top: 30px; }
    </style>
</head>
<body>

    <canvas id="embers-canvas"></canvas>

    <div id="visual-view" style="width:100%;">
        <div class="header-visual">
            <h1 class="header-large" id="admin-trigger">EL BUEN SAZÓN</h1>
            <div class="day-label">Menú del</div>
            <div id="v-day-display" class="day-main">...</div>
        </div>
        <div class="cards-container" id="v-grid"></div>
        <div id="v-contact" style="padding:40px; text-align:center; color:var(--gold);"></div>
    </div>

    <div id="gallery-overlay" onclick="closeGal()">
        <div class="slider-box" onclick="event.stopPropagation()">
            <div class="slide-container" id="slide-viewport">
                </div>
            <div id="slide-title" style="color:var(--gold); font-size:1.6rem; margin-top:20px; font-family:'Playfair Display';"></div>
            <div style="display:flex; justify-content:space-between; width:100%; position:absolute; top:40%; padding:0 10px; pointer-events:none;">
                <button onclick="prevS()" style="background:none; border:none; color:white; font-size:3rem; pointer-events:auto; cursor:pointer;">❮</button>
                <button onclick="nextS()" style="background:none; border:none; color:white; font-size:3rem; pointer-events:auto; cursor:pointer;">❯</button>
            </div>
        </div>
        <div class="close-btn" onclick="closeGal()">✕</div>
    </div>

    <div id="edition-view">
        <h2 style="color:var(--gold); margin-bottom:20px;">Panel de Control</h2>
        <div class="edit-panel">
            <label>Día Actual:</label>
            <select id="ed-day" onchange="currentData.config.dia_actual=this.value; renderEditor();">
                <option>Lunes</option><option>Martes</option><option>Miércoles</option><option>Jueves</option><option>Viernes</option><option>Sábado</option><option>Domingo</option>
            </select>
            <label>Precio Proteína:</label><input type="text" id="ed-p-prot" oninput="currentData.config.precio_proteina=this.value">
            <label>Precio Especial:</label><input type="text" id="ed-p-esp" oninput="currentData.config.precio_especial=this.value">
            <label>Contraseña:</label><input type="text" id="ed-pass" oninput="currentData.config.password=this.value">
            <label>Publicidad:</label><input type="text" id="ed-ad" oninput="currentData.config.publicidad=this.value">
            <div id="editor-items"></div>
        </div>
        <button class="btn-save-cloud" onclick="saveToCloud()">GUARDAR CAMBIOS</button>
    </div>

    <script>
        const URL_GAS = "https://script.google.com/macros/s/AKfycbwZVBesr_kEVM_biuRckKGb8qeovbmaNp-fI9b1asDSdd8tkvCw26w2L0xEqC7oI7_bA/exec";
        let currentData = { config: {}, menu: [] };
        let galleryItems = [];
        let slideIdx = 0;

        // --- BRASAS Y HUMO ---
        const canvas = document.getElementById('embers-canvas');
        const ctx = canvas.getContext('2d');
        let embers = [];

        function initEmbers() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            embers = Array.from({length: 40}, () => ({
                x: Math.random() * canvas.width, y: canvas.height + 50,
                s: Math.random() * 2 + 1, sp: Math.random() * 1.5 + 0.5, a: Math.random()
            }));
        }

        function drawEmbers() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            embers.forEach(e => {
                e.y -= e.sp; e.x += Math.sin(e.y/50)*0.5;
                if(e.y < -10) e.y = canvas.height + 50;
                ctx.fillStyle = `rgba(255, 69, 0, ${e.a})`;
                ctx.beginPath(); ctx.arc(e.x, e.y, e.s, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(drawEmbers);
        }
        initEmbers(); drawEmbers();

        // --- DATOS ---
        window.onload = fetchData;

        async function fetchData() {
            if(document.getElementById('edition-view').style.display === 'flex') return;
            try {
                const r = await fetch(URL_GAS);
                currentData = await r.json();
                renderVisual();
            } catch(e) { console.log("Error de conexión"); }
        }

        function renderVisual() {
            const hoy = currentData.config.dia_actual;
            document.getElementById('v-day-display').innerText = hoy;
            document.getElementById('v-contact').innerText = currentData.config.info_contacto;
            
            const grid = document.getElementById('v-grid');
            grid.innerHTML = "";
            
            const cats = [
                {id:'principio', n:'Principios'}, 
                {id:'proteina', n:'Proteínas', p:currentData.config.precio_proteina}, 
                {id:'especial', n:'Especiales', p:currentData.config.precio_especial}, 
                {id:'acompanamiento', n:'Acompañamientos'}
            ];

            cats.forEach((cat, idx) => {
                const items = currentData.menu.filter(i => i.dia === hoy && i.cat === cat.id);
                if(items.length === 0) return;
                
                const card = document.createElement('div');
                card.className = 'card';
                card.style.animationDelay = `${idx * 0.15}s, 0s`; // Entrada escalonada, enfriamiento inicia al tiempo
                card.onclick = () => openGal(items);

                // Inyectar humo
                for(let h=0; h<3; h++) {
                    let hDiv = document.createElement('div');
                    hDiv.className = 'smoke';
                    hDiv.style.left = Math.random()*80 + '%';
                    hDiv.style.animationDelay = Math.random()*2 + 's';
                    card.appendChild(hDiv);
                }

                let html = `<div class="card-title">${cat.n} ${cat.p ? `<br><small style="color:rgba(255,255,255,0.7)">$${cat.p}</small>` : ''}</div>`;
                items.forEach(it => {
                    html += `<div class="item-row ${it.agotado ? 'agotado' : ''}">
                        <span>${it.nombre}</span>
                        ${it.agotado ? '<b style="color:#ff4444">AGOTADO</b>' : ''}
                    </div>`;
                });
                card.innerHTML += html;
                grid.appendChild(card);
            });
        }

        // --- GALERÍA CON SLIDE LATERAL ---
        function openGal(items) {
            galleryItems = items.filter(i => i.img && i.img.length > 10);
            if(galleryItems.length === 0) return;
            slideIdx = 0;
            document.getElementById('gallery-overlay').style.display = 'flex';
            updateSlide('next');
        }

        function updateSlide(dir) {
            const viewport = document.getElementById('slide-viewport');
            const title = document.getElementById('slide-title');
            const item = galleryItems[slideIdx];

            const newImg = document.createElement('img');
            newImg.src = item.img;
            newImg.className = 'slide-img ' + (dir === 'next' ? 'slide-in-right' : 'slide-out-left');
            
            viewport.appendChild(newImg);
            title.innerText = item.nombre;

            setTimeout(() => {
                if(viewport.children.length > 1) {
                    viewport.children[0].className = 'slide-img ' + (dir === 'next' ? 'slide-out-left' : 'slide-in-right');
                    setTimeout(() => viewport.removeChild(viewport.children[0]), 600);
                }
                newImg.className = 'slide-img slide-active';
            }, 50);
        }

        function nextS() { slideIdx = (slideIdx + 1) % galleryItems.length; updateSlide('next'); }
        function prevS() { slideIdx = (slideIdx - 1 + galleryItems.length) % galleryItems.length; updateSlide('prev'); }
        function closeGal() { document.getElementById('gallery-overlay').style.display = 'none'; document.getElementById('slide-viewport').innerHTML = ""; }

        // --- EDITOR ---
        let cl = 0;
        document.getElementById('admin-trigger').onclick = () => {
            cl++; if(cl === 3) {
                if(prompt("Clave:") === currentData.config.password) {
                    document.getElementById('visual-view').style.display = 'none';
                    document.getElementById('edition-view').style.display = 'flex';
                    renderEditor();
                } cl = 0;
            } setTimeout(() => cl = 0, 1000);
        };

        function renderEditor() {
            const c = currentData.config;
            document.getElementById('ed-p-prot').value = c.precio_proteina;
            document.getElementById('ed-p-esp').value = c.precio_especial;
            document.getElementById('ed-pass').value = c.password;
            document.getElementById('ed-ad').value = c.publicidad;

            const container = document.getElementById('editor-items');
            container.innerHTML = "";
            ['principio', 'proteina', 'especial', 'acompanamiento'].forEach(catId => {
                const items = currentData.menu.filter(i => i.dia === c.dia_actual && i.cat === catId);
                let html = `<h3 style="color:var(--gold); margin:20px 0 10px 0; font-size:0.9rem;">${catId.toUpperCase()}</h3>`;
                items.forEach(it => {
                    html += `<div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:10px;">
                        <input type="text" value="${it.nombre}" oninput="upd('${it.id}','nombre',this.value)">
                        <input type="text" value="${it.img||''}" oninput="upd('${it.id}','img',this.value)">
                        <button onclick="tog('${it.id}')" style="padding:10px; background:${it.agotado?'#d35400':'#444'}; border:none; color:#fff; border-radius:5px;">${it.agotado?'AGOTADO':'OK'}</button>
                    </div>`;
                });
                html += `<button onclick="add('${catId}')" style="width:100%; padding:10px; background:none; border:1px dashed var(--gold); color:var(--gold);">+ AGREGAR</button>`;
                container.innerHTML += html;
            });
        }

        function upd(id, f, v) { const it = currentData.menu.find(i => i.id == id); if(it) it[f] = v; }
        function tog(id) { const it = currentData.menu.find(i => i.id == id); if(it) it.agotado = !it.agotado; renderEditor(); }
        function add(cat) { currentData.menu.push({id:Date.now().toString(), dia:currentData.config.dia_actual, cat:cat, nombre:"", img:"", agotado:false}); renderEditor(); }

        async function saveToCloud() {
            const b = document.querySelector('.btn-save-cloud');
            b.innerText = "SINCRONIZANDO...";
            try {
                await fetch(URL_GAS, { method: 'POST', mode: 'no-cors', body: JSON.stringify({action:'saveAll', config:currentData.config, menu:currentData.menu}) });
                alert("Guardado con éxito"); location.reload();
            } catch(e) { alert("Error"); b.innerText = "REINTENTAR"; }
        }
    </script>
</body>
</html>
